<% include partials/header %>
<div class="home-bg">
<div class="results container">
	<div id="waveform"></div>
	<a href="" id="downloader" download>
		<i class="fa fa-download"></i>


		<!-- DOWNLOAD TRACK -->
	</a>
	
	<!-- Create action buttons -->
	<input type="button" id="btn-play" value="Play" disabled="disabled"/>
	<input type="button" id="btn-pause" value="Pause" disabled="disabled"/>
	<input type="button" id="btn-stop" value="Stop" disabled="disabled" />

	
	<div class="row">
		<% if(files){ %>
			<% files.forEach(function(file) {%>
				<div class="card card-body mb-3">
					<h1 id="current-track"><%=file.filename%></h1>
					<%= file._id %>
					<%= file.metadata.genre %>
					<%= file.metadata.available %>
					<%= file.metadata.length %>
					<%= file.metadata.bpm %>
				</div>
			<% })%>
		<% } else { %>
			<p>No files to show</p>
		<% } %>%>
	</div>
	
	<hr>

</div>
</div>

<!-- main wavesurfer.js lib -->
<script src="//cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/2.0.5/wavesurfer.min.js"></script>


	<script>
		// Store the 3 buttons in some object
		 var buttons = {
		     play: document.getElementById("btn-play"),
		     pause: document.getElementById("btn-pause"),
		     stop: document.getElementById("btn-stop")
		 };

		 var downloader = document.getElementById("downloader");

		 // Create an instance of wave surfer with its configuration
		 var Spectrum = WaveSurfer.create({
		     container: '#waveform',
		     waveColor: '#darkgrey',
		     // waveColor: '#C9DD4B',
		     progressColor: '#61892f',
		     cursorColor: '#999999'
		     // scrollParent: true
		 });

		 // Handle Play button
		 buttons.play.addEventListener("click", function(){
		     Spectrum.play();

		     // Enable/Disable respectively buttons
		     buttons.stop.disabled = false;
		     buttons.pause.disabled = false;
		     buttons.play.disabled = true;
		 }, false);

		 // Handle Pause button
		 buttons.pause.addEventListener("click", function(){
		     Spectrum.pause();

		     // Enable/Disable respectively buttons
		     buttons.pause.disabled = true;
		     buttons.play.disabled = false;
		 }, false);


		 // Handle Stop button
		 buttons.stop.addEventListener("click", function(){
		     Spectrum.stop();

		     // Enable/Disable respectively buttons
		     buttons.pause.disabled = true;
		     buttons.play.disabled = false;
		     buttons.stop.disabled = true;
		 }, false);


		 // Add a listener to enable the play button once it's ready
		 Spectrum.on('ready', function () {
		     buttons.play.disabled = false;
		    
		 });

	
		 
		 // If you want a responsive mode (so when the user resizes the window)
		 // the spectrum will be still playable
		 window.addEventListener("resize", function(){
		     // Get the current progress according to the cursor position
		     var currentProgress = Spectrum.getCurrentTime() / Spectrum.getDuration();

		     // Reset graph
		     Spectrum.empty();
		     Spectrum.drawBuffer();
		     // Set original position
		     Spectrum.seekTo(currentProgress);

		     // Enable/Disable respectively buttons
		     buttons.pause.disabled = true;
		     buttons.play.disabled = false;
		     buttons.stop.disabled = false;
		 }, false);

		 // Load the audio file from your domain !

		  var current = document.getElementById("current-track");
		  // var clicker = document.getElementById("clicker");
		  current.addEventListener('click', function(){
		  	alert(this.textContent)
		  })


		 var trackName = current.textContent;
		    // console.log(trackName)
		    // var myTrackName = `http://localhost:5000/audio/${trackName}`;
		    // var myTrackName = 'http://localhost:5000/audio/' + trackName;
		    // console.log(myTrackName)
			Spectrum.load('http://localhost:5000/audio/' + trackName);
			// Spectrum.load('http://localhost:5000/audio/61Degrees1.mp3');
			// Spectrum.load('http://localhost:5000/audio/' + trackName);
						   // http://localhost:5000/audio/61%20Degrees%201.mp3
			// Spectrum.load('Advair_gff2a.mp3');
			downloader.setAttribute('href', 'Advair_gff2a.mp3');
			// downloader.setAttribute('href', 'Advair_gff2a.mp3');


		





	</script>


<% include partials/footer  %>