<% include partials/header %>
<div class="home-bg">
<div class="results container">
	<div id="waveform"></div>
	<a href="" id="downloader" download>
		<i class="fa fa-download"></i>


		<!-- DOWNLOAD TRACK -->
	</a>
	
	<!-- Create action buttons -->
	<input type="button" id="btn-play" value="Play" disabled="disabled"/>
	<input type="button" id="btn-pause" value="Pause" disabled="disabled"/>
	<input type="button" id="btn-stop" value="Stop" disabled="disabled" />


	<div class="">
	<!-- <div class="card card-body mb-3"> -->
		<ul class="list-group">
		<% files.forEach(function(file) {%>
			<button class="btn btn-track-info" id="current-track" onclick="runIt(this.value)" value="<%= file.filename %>"><%= file.filename %></button>
			<li  class="list-group-item  track-li"><%= file.metadata.description %></li>

		<% }) %>
		 </ul>
		
	</div>
	
	<hr>

</div>
</div>

<!-- main wavesurfer.js lib -->
<script src="//cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/2.0.5/wavesurfer.min.js"></script>


	<script>

		// Store the 3 buttons in some object
		 var buttons = {
		     play: document.getElementById("btn-play"),
		     pause: document.getElementById("btn-pause"),
		     stop: document.getElementById("btn-stop")
		 };

		 var downloader = document.getElementById("downloader");

		 // Create an instance of wave surfer with its configuration
		 var Spectrum = WaveSurfer.create({
		     container: '#waveform',
		     waveColor: '#darkgrey',
		     // waveColor: '#C9DD4B',
		     progressColor: '#61892f',
		     cursorColor: '#999999'
		     // scrollParent: true
		 });

		 // Handle Play button
		 buttons.play.addEventListener("click", function(){
		     Spectrum.play();

		     // Enable/Disable respectively buttons
		     buttons.stop.disabled = false;
		     buttons.pause.disabled = false;
		     buttons.play.disabled = true;
		 }, false);

		 // Handle Pause button
		 buttons.pause.addEventListener("click", function(){
		     Spectrum.pause();

		     // Enable/Disable respectively buttons
		     buttons.pause.disabled = true;
		     buttons.play.disabled = false;
		 }, false);


		 // Handle Stop button
		 buttons.stop.addEventListener("click", function(){
		     Spectrum.stop();

		     // Enable/Disable respectively buttons
		     buttons.pause.disabled = true;
		     buttons.play.disabled = false;
		     buttons.stop.disabled = true;
		 }, false);


		 // Add a listener to enable the play button once it's ready
		 Spectrum.on('ready', function () {
		     buttons.play.disabled = false;
		    
		 });

	
		 
		 // If you want a responsive mode (so when the user resizes the window)
		 // the spectrum will be still playable
		 window.addEventListener("resize", function(){
		     // Get the current progress according to the cursor position
		     var currentProgress = Spectrum.getCurrentTime() / Spectrum.getDuration();

		     // Reset graph
		     Spectrum.empty();
		     Spectrum.drawBuffer();
		     // Set original position
		     Spectrum.seekTo(currentProgress);

		     // Enable/Disable respectively buttons
		     buttons.pause.disabled = true;
		     buttons.play.disabled = false;
		     buttons.stop.disabled = false;
		 }, false);

		 // Load the audio file from your domain !

		  var current = document.getElementById("current-track");

		window.onload = function(){
			// Spectrum.load('https://immense-atoll-44421.herokuapp.com/audio/' + current.textContent);
			Spectrum.load('http://localhost:8080/audio/' + current.textContent)
			// Spectrum.load('https://vast-dusk-24076.herokuapp.com/audio/' + current.textContent)
		}

		  function runIt(trackName){
		  	// var curTrack = 'https://immense-atoll-44421.herokuapp.com/audio/' + trackName;
		  	var curTrack = 'http://localhost:8080/audio/' + trackName;
		  	// var curTrack = 'https://vast-dusk-24076.herokuapp.com/audio/' + trackName;
			Spectrum.load(curTrack);
			downloader.setAttribute('href', curTrack);
		  }


	</script>


<% include partials/footer  %>